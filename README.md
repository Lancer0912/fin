# 火車票售票系統
## 1. 引言
隨著電腦科技的發展,用電腦為人們的生活服務已經變得普及化。鐵路公司為了增強公司的資訊化程度,提高公司的售票管理的效率,就建立起了相應的火車票訂系統,實現提高了火車客用系統的售票效率和管理水平。
火車票訂票系統是典型的資訊管理系統的一部分,火車票訂票系統的開發充分利用了電腦資訊科技提高了火車票訂票的管理水準、服務水準。系統實現了乘客查詢資訊、訂票操作、取票操作、銷售統計等功能,可明顯提高對火車票訂票的有效管理。
### 編寫目的
本火車站售票系統的根本目的在於透過電腦實現票務資訊的統一管理,來提高工作效率,使售票員售票和乘客購票更加方便。實現電腦管理的最佳技術就是資料庫技術。我們可以利用資料庫將整個火車站的票務情況存入電腦,再配置上功能豐富的用戶介面,以滿足用戶需求。一個火車站售票資訊管理系統應達到的目標是提供及時、準確的資訊服務,加快資訊檢索的效率,實況靈活的查詢,減輕管理人員製作報表和統計分析的負擔,且系統規模不太大但又要確保支援日常工作的要求,以便系統應易於擴充,方便日後統一聯網與管理,提高管理水平。
### 範圍
#### 軟體系統名稱:火車票預訂系統
此系統的中心功能是列車車次和售票資訊的查詢功能和售票功能。雖然這兩個看似截然不同的功能,但它們在實現上十分的類似,售票就需要首先先通過查詢的方式得到滿足要求的列車車次,然後再根據實際情況進行售票。所以售票功能可以看成是列車車次和售票資訊查詢功能的延伸。
支出:該系統為軟體工程作業,故無經費支出。
收益:系統完成後即可交付使用,主要是為了方便火車站售票人員使用,有著重人的利益。
### 定義
**1.3.1 專門術語**

SQL SERVER:系統伺服器所使用的資料庫管理系統(DBMS)。

SQL:全名為 Structured Query Language(結構化查詢語言)。一種用於存取查詢資料庫的語言。

ROLLBACK:資料庫的錯誤回覆機制。

事物流:資料進入模組後可能有多種路徑進行處理。

主鍵:資料庫表中的關鍵域。值互不相同。

外部主鍵:資料庫表中與其他表主鍵關聯的域。

系統:若未特別指出,系統指火車站售票系統。

參考資料

軟體設計文件國家標準－詳細設計說明書

車票預訂系統專案開發計畫書

車票預訂系統需求分析說明書

《軟體工程案例教學》 機械工業出版社 韓萬江著 2011年8月第一版

## 2. 專案概述
### 2.1 產品描述
火車票售票系統是一個融合火車票的訂票、賣票、退票、車票管理、售票點管理、列車車次資訊查詢及售票資訊查詢等為融為一體的綜合系統。
### 2.2 產品功能
本系統主要用於火車票的銷售,提供了以下幾個子功能:用戶註冊登錄和火車票信息查詢、訂票查詢、火車票預訂、退票申請以及後台方面的列車車次信息發布更新、車票生成、提供取票服務成等後台功能。

根據可行性研究的結果和客戶的要求,分析現有情況及問題,採用Client/Server 結構,將火車票售票系統劃分為兩個子系統:客戶端子系統,服 務器端子系統。故火車票售票系統將由四部分組成:網路訂票客戶端系統,售 票員服務系統,系統管理員系統、資料庫伺服器管理系統。本系統的各系統的關係如下:
![image](https://github.com/Lancer0912/fin/blob/main/image/2-2%E7%B3%BB%E7%B5%B1%E9%97%9C%E4%BF%82%E5%9C%96.png)
### 2.3 用戶特點
此系統的使用者有四類,他們分別是一般使用者旅客(以旅遊出差人士為土)、車站售票員、代售點售票員,系統管理員。他們的電腦使用水準,其中旅客中有好有差;車站售票員、代售點售票員能熟練地操作使用的系統;系統管理員可以根據具體需要進行適當的數據操作,並對系統進行必要的維護;
#### 一般約束
超級管理員,可以根據具體需要進行適當的資料操作(增、刪、改、更),並對系統進行必要的維護;

普通管理員,能對庫(車次庫和客戶庫)中的信息進行查詢操作,並可以在提供其帳戶的條件下,進行有權限的操作;

客戶只能對航班資訊庫中的內容進行查詢操作,客戶進入到頁面之後在不進行登入的情況下只能進行火車資訊的查詢操作,要預訂車票就必須要先註冊登入提交自己的真實的、可用的基本資訊;

系統會根據管理員和客戶的各種操作做出相應的返回資訊進行提示。
### 3.1 功能需求
#### 火車站售票系統將由四部組成:
線上訂票客戶系統,售票員服務系統,系統管理員系統、資料庫伺服器管理系統。

系統資料流程如下圖
![image](https://github.com/Lancer0912/fin/blob/main/image/3-1%E9%A0%82%E5%B1%A4%E6%95%B8%E6%93%9A%E6%B5%81%E7%A8%8B%E5%9C%96.png)

頂層數據流程圖

![image](https://github.com/Lancer0912/fin/blob/main/image/3-1%E7%AC%AC%E4%B8%80%E5%B1%A4%E6%95%B8%E6%93%9A%E6%B5%81%E7%A8%8B%E5%9C%96.png)

第一層數據流程圖

![image](https://github.com/Lancer0912/fin/blob/main/image/3-1%E7%AC%AC%E4%BA%8C%E5%B1%A4%E6%95%B8%E6%93%9A%E6%B5%81%E7%A8%8B%E5%9C%96.png)

第二層數據流程圖

### 3.2 性能需求
(1)對伺服器的要求,至少能夠滿足2000同時線上存取。

(2)對客戶端,在現使用的電腦中安裝即可使用,要求不高。

(3)使用本系統功能時,電腦配置一般情況下,一般事務相應時間不能超3 秒,其中時間包括:輸入、輸出和傳輸的響應時間等。

## 4. 接口設計
### 4.1 軟體接口
伺服器程式可使用.NET提供的與資料庫連接的介面,進行資料庫的存取。

伺服器程式上可使用 Navicate for SQL 對資料庫的備份指令,以做到資料 庫的保存。

在網路軟體介面方面,使用無錯誤的傳輸協定,採用滑動視窗式對資料 進行網路傳輸及接收。

### 4.2. 硬體接口
在輸入方面,對於鍵盤、滑鼠的輸入,使用標準輸入/輸出,對輸入進行處理。

在輸出方面,印表機的連接及使用,也可標準輸入/輸出處理。在 網路傳輸部分,在網路硬體部分,為了實現高速傳輸,將使用高速ATM.

### 內部接口
系統由六個模組組成,分別是查詢模組、售票模組、修改模組、退票模 區塊、統計模組、系統維護管理模組。其關係如下圖
![image](https://github.com/Lancer0912/fin/blob/main/image/4-2%E6%A8%A1%E5%A1%8A%E9%97%9C%E4%BF%82%E5%9C%96.png)

模塊關係圖

系統E-R圖如下:

1.E--R圖
![image](https://github.com/Lancer0912/fin/blob/main/image/4-2E-R%E5%9C%96.png)

列車-時間ER圖如下:
![image](https://github.com/Lancer0912/fin/blob/main/image/4-2%E5%88%97%E8%BB%8A-%E6%99%82%E9%96%93ER%E5%9C%96.png)

售票ER圖如下:
![image](https://github.com/Lancer0912/fin/blob/main/image/4-2%E5%94%AE%E7%A5%A8ER%E5%9C%96.png)
## 物理結構設計
### 5.物理結構設計要點
![image](https://github.com/Lancer0912/fin/blob/main/image/5%20%E7%89%A9%E7%90%86%E7%B5%90%E6%A7%8B%E8%A8%AD%E8%A8%88%E8%A6%81%E9%BB%9E%E5%9C%96.png)
**管理員信息**
| 名稱        | 類型   | 主鍵  | 外鍵 | 是否為空  | 默認值     |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| 管理員ID| Varchar(10)| 是 | 否 | 否 | 001|
| 管理員姓名| Varchar(50)| 否 | 否 | 否 | Admin|
| 管理員密碼| Varchar(16)| 否 | 否 | 否 | 123456|

**售票服務員工信息**

| 名稱        | 類型   | 主鍵  | 外鍵 | 是否為空  | 默認值     |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| 員工ID| Varchar(10)| 是 | 否 | 否 | 100|
| 員工姓名| Varchar(50)| 否 | 否 | 否 | 無|
| 員工密碼| Varchar(16)| 否 | 否 | 否 | 無|
| 證件號碼| Varchar(20)| 否 | 否 | 否 | 無|
|        | Varchar(50)| 否 | 否 | 否 | 無|
| 聯繫| Varchar(20)| 否 | 否 | 否 | 無|

**用戶註冊信息**

| 名稱        | 類型   | 主鍵  | 外鍵 | 是否為空  | 默認值     |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| 用戶ID| Varchar(10)| 是 | 否 | 否 | 10000|
| 用戶密碼| Varchar(16)| 否 | 否 | 否 | 無|
| 證件號碼| Varchar(20)| 否 | 否 | 否 | 無|
| 真實姓名| Varchar(50)| 否 | 否 | 否 | 無|
|        | Varchar(100)| 否 | 否 | 否 | 無|
| 郵政編號 | Varchar(10)| 否 | 否 | 否 | 無|
| 聯繫| Varchar(20)| 否 | 否 | 否 | 無|

**用戶訂票信息**

| 名稱        | 類型   | 主鍵  | 外鍵 | 是否為空  | 默認值     |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| 訂單號| Varchar(10)| 是 | 否 | 否 | 10000|
| 乘車日期| Datetime| 否 | 否 | 是 | 無|
| 車次| Varchar(10)| 否 | 是 | 是 | 無|
|始發站| Varchar(10)| 否 | 否 | 是 | 無|
| 終點站 | Varchar(10)| 否 | 否 | 是 | 無|
| 席別| Varchar(10)| 否 | 否 | 是 | 無|
| 票種| Varchar(10)| 否 | 否 | 是 | 無|
| 張數| Varchar(5)| 否 | 否 | 是 | 1|
| 備註| Varchar(100)| 否 | 否 | 是 | 無|

**列車信息表**

| 名稱        | 類型   | 主鍵  | 外鍵 | 是否為空  | 默認值     |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
|始發站| Varchar(10)| 否 | 否 | 是 | 無|
| 車次| Varchar(10)| 是 | 否 | 否 | 無|
| 終點站 | Varchar(10)| 否 | 否 | 是 | 無|
| 發車時間 |Datetime| 否 | 否 | 是 | 無|
| 停靠站 |Varchar(10)| 否 | 否 | 是 | 無|
| 到站時間 |Datetime| 否 | 否 | 是 | 無|
| 票種| Varchar(10)| 否 | 否 | 是 | 無|

**旅客所定火車表**

| 名稱        | 類型   | 主鍵  | 外鍵 | 是否為空  | 默認值     |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| 票種| Varchar(10)| 是 | 否 | 否 | 無|
| 車次| Varchar(10)| 否 | 是 | 否 | 無|
| 張數| Varchar(10)| 否 | 否 | 是 | 1|

### 5.3 資料結構與程序的關係
1.使用者登入時,後台伺服器尋找資料庫,符合對應的使用者名稱和密碼,若未找到,則回傳錯誤訊息。

2.登入訂票系統,用到員工表,透過每一個售票員來操作每一個終端,通過對用戶需求(即:用戶買票的要求填寫訂單資訊表,包括火車票表)。

3,若要查詢統計功能則需要以管理員身分登入,用到管理員資訊表,管理員可以修改列車時刻表。

## 6.運行設計
### 運作模組組合
用戶端程式在有輸入時啟動接收資料模組,透過各模組之間的呼叫,讀入並對輸入進行格式化。在接收資料模組得到充分資料時,將呼叫網路傳輸模組,將資料透過網路送到伺服器,並等待接受伺服器回傳的資訊。接收到回傳訊息後隨時即調用資料輸出模組,對資訊進行處理,產生對應的輸出。

伺服器程式的接收網路資料模組必須始終處於活動狀態。接收到資料後,呼叫資料處理/查詢模組對資料庫進行存取,完成後呼叫網路傳送模組,將資訊傳回用戶端。
### 6.2 運轉控制
運行控制將嚴格依照各模組間函數呼叫關係來實現。在各事務中心模組中,需對運轉控制進行正確的判斷,選擇正確的運轉控制路徑。

在網路傳輸方面,用戶端在發送資料後,將等待伺服器的確認收到訊號,收到後,再次等待伺服器發送回答資料,然後對資料進行確認。伺服器接到資料後發送確認訊號,在資料處理、存取資料庫後,將傳回訊息回傳用戶端,並等待確認。
### 6.3 運行時間
在需求分析中,對時間的要求必須對作出的操作有較快的反應。網路硬體對運行時間有最大的影響,當網路負載量大時,對操作反應將受到很大的影響。所以將採用高速ATM(非同步傳輸模式)網路,實現用戶端與伺服器之間的連線,以減少網路傳輸上的開銷,其次是伺服器的效能,這將影響對資料庫存取時間即操作時間的長短,影響加大客戶機操作的等待時間,所以必須使用高效能的伺服器,軟體對本系統的速度影響將會大於硬體的影響。
## 7.系統出錯處理設計
### 7.1 出錯訊息
程式在執行時主要會出現兩種錯誤:(1)由於輸入訊息,或無法滿足要求 時產生的錯誤,稱為軟錯誤。 (2)由於其他問題,如網路傳輸逾時等,產生的 問題,稱為硬錯誤。

對於軟錯誤,須在訂票、購票、退票和取票操作成功判斷及輸入資料驗證模區塊由資料進行資料分析,判斷錯誤類型,再產生對應的錯誤提示語句,送到輸 出模組中。對於硬錯誤,可在出錯的對應模組中輸出簡單的出錯語句,並將程 序重設。返回輸入階段。

出錯訊息必須給予對應的出錯原因,例:「該列火車已滿!」,「查無此信 息!」等等。
### 7.2 補救措施
所有的用戶端及伺服器都必須安裝不間斷電源以防止停電或電壓不穩定造成的資料遺失的損失。若真斷電時,用戶端將不會有太大的影響,主要是伺服器上:在斷電後復原過程可採用SQL SERVER的日誌檔,對其進行ROLL BACK處理,對資料進行復原。

在網路傳輸方面,可考慮建立一條成本較低的後備網路,以確保當主網路斷 路時資料的通訊。

在硬體方面要選擇叫可靠、穩定的伺服器機種,保證系統運作的可靠性。

# 資料參考
火車訂票管理系統(https://www.renrendoc.com/paper/214304236.html)

